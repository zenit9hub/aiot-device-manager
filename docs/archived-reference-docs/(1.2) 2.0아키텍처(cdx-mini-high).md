# 2.0 ì•„í‚¤í…ì²˜

## ğŸ“ ì„œë‘ë§
ìƒìš© ì„œë¹„ìŠ¤ë¡œ ê²€ì¦ëœ Firebase Â· AWSì˜ ë§¤ë‹ˆì§€ë“œ ê¸°ëŠ¥ì„ ì¡°í•©í•˜ì—¬, ë°±ì—”ë“œ ì¸í”„ë¼ë¥¼ ì§ì ‘ ìš´ì˜í•˜ì§€ ì•Šê³  í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì—ë§Œ ì§‘ì¤‘í•˜ëŠ” ê²ƒì´ ì´ ì•„í‚¤í…ì²˜ì˜ í•µì‹¬ ì² í•™ì…ë‹ˆë‹¤. ì‚¬ìš©ì ê²½í—˜ê³¼ ì‹¤ì‹œê°„ ì‹œê°í™”ì— ì§‘ì¤‘í•˜ëŠ” íŒ€ì€ ì¸í”„ë¼Â·ë³´ì•ˆÂ·ë°°í¬ë¥¼ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ì— ìœ„ì„í•˜ê³ , í™•ì¥ ê°€ëŠ¥í•œ MVPë¥¼ ë¹ ë¥´ê²Œ ì™„ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## ğŸ“‹ ë¬¸ì œ ì •ì˜
- **ìƒí™©**: AIoT ì„œë¹„ìŠ¤ í”Œë«í¼ MVP 1ë‹¨ê³„ ê°œë°œ, ì‹¤ì‹œê°„ ë””ë°”ì´ìŠ¤ ì œì–´ë¥¼ êµ¬í˜„í•´ì•¼ í•¨  
- **ì œì•½**: ì†Œê·œëª¨ íŒ€, ì§§ì€ ê°œë°œ ì£¼ê¸°, ë°±ì—”ë“œ ìš´ì˜ ê²½í—˜ì´ ì œí•œì   
- **ëª©í‘œ**: ì‚¬ìš©ìê°€ ë””ë°”ì´ìŠ¤ë¥¼ ë“±ë¡Â·ëª¨ë‹ˆí„°ë§Â·ì œì–´í•  ìˆ˜ ìˆëŠ” ì‹¤ì‹œê°„ ì‹œê°í™” í”Œë«í¼ í‘œí˜„  
- **í•µì‹¬ í¬ì»¤ìŠ¤**: ê´€ë¦¬í˜• Auth/DB/í˜¸ìŠ¤íŒ… Â· SDK ì¤‘ì‹¬ FE Â· ë³´ì•ˆ ê·œì¹™ ê¸°ë°˜ ë°ì´í„° ê²©ë¦¬ë¡œ ìµœì†Œ ì¸í”„ë¼ë¡œ ìµœëŒ€ í¼í¬ë¨¼ìŠ¤ í™•ë³´

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”
1. **FE ì¤‘ì‹¬ íë¦„**: Vite + Tailwind ê¸°ë°˜ SPAê°€ ëª¨ë“  UI/UX ë¡œì§ì„ ì±…ì„ì§€ê³ , SDK í˜¸ì¶œë§Œìœ¼ë¡œ í†µì‹ Â·ì¸ì¦Â·ë°ì´í„°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.  
2. **Serverless-first ì„¤ê³„**: Firebase Auth â†’ Firestore ì‹¤ì‹œê°„ DB â†’ Amplify ì •ì  í˜¸ìŠ¤íŒ… íë¦„ë§Œìœ¼ë¡œ CRUD/ì‹¤ì‹œê°„ ë™ê¸°í™” ë‹¬ì„±.  
3. **ë³´ì•ˆê³¼ ê²©ë¦¬**: Firebase Security Rulesì— ì‚¬ìš©ìë³„ ì ‘ê·¼ ì œì–´ë¥¼ ì •ì˜í•˜ê³ , ì¸ì¦ëœ í† í°ë§Œ Firestore ë¬¸ì„œì— ì ‘ê·¼ ê°€ëŠ¥.
4. **í™•ì¥ì„±**: Phase 2 ì‹œì ì— NestJS/Expressì™€ ê°™ì€ ë°±ì—”ë“œ APIë¥¼ Firebase Auth í† í°ìœ¼ë¡œ ë³´í˜¸í•˜ì—¬ ê¸°ì¡´ FE êµ¬ì¡°ë¥¼ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í–ˆìŠµë‹ˆë‹¤.

## ğŸ§° ê¸°ìˆ  ìŠ¤íƒ

| ê³„ì¸µ | ì„ íƒ ê¸°ìˆ  | ì—­í•  | ê°•ì  |
|---|---|---|---|
| Authentication | Firebase Auth | ì‚¬ìš©ì ë¡œê·¸ì¸, ID í† í° ë°œê¸‰ | OAuth í†µí•©, í´ë¼ì´ì–¸íŠ¸ SDK ê¸°ë°˜ ìƒíƒœ ê´€ë¦¬, ë³´ì•ˆ ê·œì¹™ê³¼ ì—°ê³„ |
| Database | Firestore | NoSQL ì‹¤ì‹œê°„ ë°ì´í„° ìŠ¤í† ì–´ | onSnapshot ì‹¤ì‹œê°„, offline cache, ìë™ í™•ì¥, ì‚¬ìš©ì ë‹¨ìœ„ ë³´ì•ˆ ê·œì¹™ |
| Hosting | AWS Amplify | Git ê¸°ë°˜ ë¹Œë“œ Â· CDN ë°°í¬ | git push ìë™ ë°°í¬, CloudFront + SSL, í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬ |
| Frontend | Vite + Vanilla JS/Vue | ë¹ ë¥¸ ê°œë°œ/ë¹Œë“œ | HMR, ê²½ëŸ‰ ë²ˆë“¤, TypeScript ì—°ë™ ìš©ì´ |
| Styling | Tailwind CSS | ìœ í‹¸ë¦¬í‹° ì¤‘ì‹¬ UI | ì¼ê´€ëœ ë””ìì¸, ì‘ì€ í´ë˜ìŠ¤ ì¡°í•©ë§Œìœ¼ë¡œ ìœ ì—°í•œ UI êµ¬ì„± |

### í•µì‹¬ ê¸°ìˆ ë³„ ê°„ê²°í•œ ì´ìœ 
- **Firebase Auth**: OAuth, Email ë¡œê·¸ì¸ê³¼ í† í°ì´ í†µí•©ë˜ì–´ ìˆì–´ ë°±ì—”ë“œ ì—†ì´ë„ ì¸ì¦Â·ì¸ê°€ êµ¬í˜„ì´ ê°€ëŠ¥. |  
- **Firestore**: ì½ê¸°/ì“°ê¸° ì´ë²¤íŠ¸ë¥¼ ìë™ ìŠ¤íŠ¸ë¦¬ë°, `where('userId','==',uid)` ì¿¼ë¦¬ë¡œ ì‚¬ìš©ì ë‹¨ìœ„ ì •ë³´ ê²©ë¦¬ ê°€ëŠ¥.  
- **AWS Amplify**: Amplify Consoleì´ Git ë¸Œëœì¹˜ë¥¼ ë¹Œë“œí•˜ê³  ì •ì  ìì‚°(HTTPS+CDN)ì„ ì „ ì„¸ê³„ì— ë°°í¬.  
- **Vite/Tailwind**: ë¹ ë¥¸ ê°œë°œì„œë²„ì™€ ì¼ê´€ëœ ìŠ¤íƒ€ì¼ ì²´ê³„ë¡œ ì‹¤ìŠµìê°€ ì¦‰ì‹œ UIë¥¼ í™•ì¥ ê°€ëŠ¥.

## ğŸ’¡ í”Œë«í¼ ë””ìì¸

### ì‚¬ìš©ì ê´€ì  ì„œë¹„ìŠ¤ íë¦„
```mermaid
graph LR
    U[ì‚¬ìš©ì] -->|HTTPS| CDN[CloudFront CDN]
    CDN --> AMP[AWS Amplify<br/>Host]
    AMP --> FE[Vite SPA]
    FE -->|Firebase SDK| AUTH[Firebase Auth]
    FE -->|Firestore SDK| FS[Firestore]
    FE -.->|MQTT WebSocket| MQTT[MQTT Broker]
    subgraph "ë³´ì•ˆ ê·œì¹™"
        AUTH -.-> FS
    end
```

ì˜ˆì‹œ í‚¤ì›Œë“œ íë¦„: `ì‚¬ìš©ì â†’ ì„œë¹„ìŠ¤ Endpoint [FE â†’ Amplify â†’ Firebase Auth â†’ Firestore]`

### ì‹œí€€ìŠ¤ íë¦„ (ë“±ë¡Â·ëª¨ë‹ˆí„°ë§)
```mermaid
sequenceDiagram
    participant U as ì‚¬ìš©ì
    participant FE as Frontend
    participant AUTH as Firebase Auth
    participant FS as Firestore
    participant MQTT as MQTT Broker

    U->>FE: ë¡œê·¸ì¸ ì‹œë„
    FE->>AUTH: signInWithPopup(GoogleProvider)
    AUTH-->>FE: User + ID Token
    FE->>FS: onSnapshot(devices where userId)
    FS-->>FE: ì‹¤ì‹œê°„ ë””ë°”ì´ìŠ¤ ë¦¬ìŠ¤íŠ¸
    MQTT->>FE: ë””ë°”ì´ìŠ¤ ìƒíƒœ ì´ë²¤íŠ¸
    FE->>FS: updateDoc(status)
    FS-->>FE: ìƒíƒœ ë³€ê²½ ì´ë²¤íŠ¸
    FE->>U: ì‹¤ì‹œê°„ ì‹œê°í™”/ì•Œë¦¼
```

## ğŸ” API ëª…ì„¸ì„œ

### Authentication (Firebase Auth SDK)
```javascript
signInWithEmailAndPassword(email, password)
signInWithPopup(new GoogleAuthProvider())
signOut()
const token = await user.getIdToken()
onIdTokenChanged((user) => { /* Token refresh */ })
```

### Firestore (ì‹¤ì‹œê°„ êµ¬ë… ì¤‘ì‹¬)
```javascript
const deviceQuery = query(collection(db, 'devices'), where('userId', '==', uid));
const unsubscribe = onSnapshot(deviceQuery, (snapshot) => {
  snapshot.docChanges().forEach(change => { /* added/modified -> refresh UI */ });
});

await addDoc(collection(db, 'devices'), deviceData);
await updateDoc(doc(db, 'devices', deviceId), { status: 'online' });
await deleteDoc(doc(db, 'devices', deviceId));
```

### ë³´ì•ˆ ê·œì¹™ (Firestore)
```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /devices/{deviceId} {
      allow read, write: if request.auth != null
        && request.auth.uid == resource.data.userId;
    }
  }
}
```

## âš™ï¸ í™˜ê²½ êµ¬ì„± ê°€ì´ë“œ

1. **Firebase ì¤€ë¹„**
   - í”„ë¡œì íŠ¸ ìƒì„± â†’ Authentication (Email + Google OAuth) â†’ Firestore ìƒì„±
   - ìŠ¹ì¸ëœ ë„ë©”ì¸ì— `localhost`, `*.amplifyapp.com` ì¶”ê°€ â†’ ì›¹ ì•± ë“±ë¡ â†’ config í™•ë³´
2. **í™˜ê²½ ë³€ìˆ˜**
   ```bash
   cp .env.example .env
   VITE_FIREBASE_API_KEY=â€¦
   VITE_FIREBASE_AUTH_DOMAIN=â€¦
   VITE_FIREBASE_PROJECT_ID=â€¦
   ```
3. **ë¡œì»¬ ì‹¤í–‰**
   ```bash
   npm install
   npm run dev  # http://localhost:5173
   ```
4. **ì‹¤ìŠµ íŒ**
   - Firebase Emulator Suiteë¡œ ë¡œì»¬ Firestore/Auth í…ŒìŠ¤íŠ¸
   - `onSnapshot` ì½œë°±ì— Loading/empty ìƒíƒœ ì²˜ë¦¬ ì¶”ê°€

## ğŸš€ ë°°í¬Â·ìš´ì˜ ê°€ì´ë“œ

### AWS Amplify ë°°í¬
1. Amplify Console â†’ Host web app â†’ GitHub/GitLab ì—°ê²° â†’ main ë¸Œëœì¹˜ ì„ íƒ  
2. `amplify.yml` ì„¤ì •
   ```yaml
   version: 1
   frontend:
     phases:
       preBuild:
         commands:
           - npm ci
       build:
         commands:
           - npm run build
     artifacts:
       baseDirectory: dist
       files:
         - '**/*'
     cache:
       paths:
         - node_modules/**/*
   ```
3. Amplify í™˜ê²½ ë³€ìˆ˜ì— Firebase config ì£¼ì… â†’ `VITE_FIREBASE_*` ì„¤ì •
4. Git Push ì‹œ ìë™ ë¹Œë“œÂ·ë°°í¬ â†’ Amplify URLì„ Firebase ìŠ¹ì¸ ë„ë©”ì¸ì— ì¶”ê°€

### ìš´ì˜ ëª¨ë‹ˆí„°ë§
- Firebase Console: Authentication ì‚¬ìš©ì í™œë™, Firestore ì½ê¸°/ì“°ê¸° ì‚¬ìš©ëŸ‰ â†’ ê³¼ê¸ˆ ê²½ê³  ì„¤ì •  
- Amplify Console: ë¹Œë“œ ì„±ê³µ/ì‹¤íŒ¨ + íŠ¸ë˜í”½/ì§€ì—° ëª¨ë‹ˆí„°ë§, ë°°í¬ URL health ì²´í¬

### Phase 2 í™•ì¥ ì‹œë‚˜ë¦¬ì˜¤ (ë°±ì—”ë“œ ì¶”ê°€)
```text
ì‚¬ìš©ì â†’ Amplify â†’ Frontend
                  â†“
              Firebase Auth (í† í° validation)
                  â†“
              Backend API (NestJS / Express)
                  â†“
              PostgreSQL / MySQL (ê´€ê³„í˜•)
                  â†“
              Firestore (ì‹¤ì‹œê°„ ìƒíƒœ)
```
- Backend APIëŠ” Firebase Admin SDKë¡œ í† í° ê²€ì¦ â†’ FirestoreëŠ” ì‹¤ì‹œê°„ ë·°, ì¤‘ìš” ë°ì´í„°ëŠ” ê´€ê³„í˜• DBë¡œ ì´ê´€  
- Batch ì²˜ë¦¬, ì™¸ë¶€ API ì—°ë™(ERP, ì•Œë¦¼), ê°ì‚¬ ë¡œê·¸ ì €ì¥ ë“±ì„ ìƒˆë¡œìš´ ì„œë¹„ìŠ¤ ê³„ì¸µì—ì„œ ì‹¤í–‰

## ğŸ”‘ í•µì‹¬ í‚¤ì›Œë“œ
- `Firebase Security Rules` â†’ ì‚¬ìš©ìë³„ ë°ì´í„° ê²©ë¦¬ ë° Firebase RBAC  
- `Firestore onSnapshot` â†’ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ + ìƒíƒœ ê´€ë¦¬ ì „ëµ  
- `MQTT over WebSocket` â†’ ê³µí†µ MQTT ë¸Œë¡œì»¤ë¥¼ í†µí•œ ì„¼ì„œ ë°ì´í„° íŒŒì´í”„ë¼ì¸  
- `Vite Plugin Ecosystem` â†’ ìƒì‚°ì„± í–¥ìƒ ë° PWA/SSR í™•ì¥  
- `CloudFront Cache Invalidation` â†’ CDN ìºì‹± ì „ëµ ë° ë°°í¬ ë¡¤ë°±  
- `Amplify Environment Variables` â†’ stageë³„ Firebase config ë¶„ë¦¬  
- `Phase 2 Backend` â†’ í† í° ê¸°ë°˜ API ê²Œì´íŠ¸ì›¨ì´ ë° ê´€ê³„í˜• DB ì—°ë™  
- `Observability` â†’ Firebase/Amplify ëª¨ë‹ˆí„°ë§ê³¼ ë¹„ìš© ì•Œë¦¼
